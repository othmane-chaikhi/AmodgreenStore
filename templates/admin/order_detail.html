{% extends 'base.html' %}
{% block title %}D√©tail commande #{{ order.id }}{% endblock %}

{% block content %}
<div class="container mx-auto p-6">
    <h1 class="text-2xl font-bold mb-4">D√©tail de la commande #{{ order.id }}</h1>

    <!-- üßæ Informations client -->
    <div class="bg-gray-100 p-4 rounded shadow mb-6">
        <h2 class="text-xl font-semibold mb-2">Informations du client</h2>
        <p><strong>Nom complet :</strong> {{ order.full_name }}</p>
        <p><strong>Num√©ro de t√©l√©phone :</strong> {{ order.phone }}</p>
        <p><strong>Ville :</strong> {{ order.city }}</p>
        <p><strong>Adresse :</strong> {{ order.address }}</p>
        {% if order.notes %}
            <p><strong>Remarques :</strong> {{ order.notes }}</p>
        {% endif %}
    </div>

    <!-- üì¶ D√©tails produits -->
    <div class="bg-white p-4 rounded shadow mb-6">
        <h2 class="text-xl font-semibold mb-2">Produits command√©s</h2>
        <ul class="list-disc ml-6">
            {% for item in order.items.all %}
                <li>{{ item.variant.product.name }} ({{ item.variant.name }}) - {{ item.quantity }} x {{ item.price }} MAD</li>
            {% endfor %}
        </ul>
        <p class="mt-4 font-semibold">üí∞ Prix total : {{ order.total_price }} MAD</p>
    </div>

    <!-- üöö Statut -->
    <div class="bg-white p-4 rounded shadow mb-6">
        <h2 class="text-xl font-semibold mb-2">Statut de la commande</h2>
        <span class="px-3 py-2 rounded-full text-sm font-semibold
            {% if order.status == 'delivered' %}bg-green-100 text-green-800
            {% elif order.status == 'contacted' %}bg-blue-100 text-blue-800
            {% elif order.status == 'pending' %}bg-yellow-100 text-yellow-800
            {% elif order.status == 'cancelled' %}bg-red-100 text-red-800
            {% else %}bg-gray-100 text-gray-800{% endif %}">
            {{ order.get_status_display }}
        </span>
        <p class="text-sm text-gray-600 mt-2">Commande cr√©√©e le {{ order.created_at|date:"d/m/Y √† H:i" }}</p>
    </div>

    <!-- ‚úÖ Actions -->
    {% if order.status != 'delivered' and order.status != 'cancelled' %}
    <div class="bg-white p-4 rounded shadow mb-6">
        <h2 class="text-xl font-semibold mb-4">Actions disponibles</h2>
        <form method="post" class="flex flex-wrap gap-3">
            {% csrf_token %}
            {% if order.status == 'pending' %}
                <button name="action" value="contact" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium">
                    üìû Marquer comme "Client contact√©"
                </button>
                <button name="action" value="cancel" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg font-medium">
                    ‚ùå Annuler la commande
                </button>
            {% elif order.status == 'contacted' %}
                <button name="action" value="deliver" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium">
                    ‚úÖ Marquer comme "Livr√©"
                </button>
                <button name="action" value="cancel" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg font-medium">
                    ‚ùå Annuler la commande
                </button>
            {% endif %}
        </form>
    </div>
    {% else %}
    <div class="bg-gray-50 p-4 rounded shadow mb-6">
        <p class="text-gray-600">Cette commande est termin√©e. Aucune action disponible.</p>
    </div>
    {% endif %}

    <a href="{% url 'admin_dashboard' %}" class="inline-block mt-6 text-blue-600 hover:underline">‚Üê Retour au tableau de bord</a>
</div>
{% endblock %}
